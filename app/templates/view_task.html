{% from "_macros.html" import form_group_field %}
{% extends "base.html" %}
{% block content %}
    <div class="col-md-10">
        <div class="left">
            <h2>{{task.title}}</h2>
        </div>
        <div class="right">
            <p>Created: {{task.created}}</p>
            <p>
                Status: {{g.TASK_STATUSES[task.status]}}
            </p>
            {% if g.user.id == task.doer_id %}
                <p>
                    Assigned to you by <a href="{{url_for('profile_page', id=task.requester_id)}}">{{task.requester.username}}</a>
                </p>
                {% if task.status == 0 %}
                    <form action="{{url_for('task_set_status', id=task.id, status=1)}}" method="post">
                        <button type="submit" class="btn btn-success">
                            Start
                        </button>
                    </form>
                {% elif task.status == 1 %}
                    <form action="{{url_for('task_set_status', id=task.id, status=2)}}" method="post">
                        <button type="submit", class="btn btn-info">
                            Complete
                        </button>
                    </form>
                {% endif %}
            {% elif g.user.id == task.requester_id %}
                <p>
                    Assigned to <a href="{{url_for('profile_page', id=task.doer_id)}}">{{task.doer.username}}</a> by you.
                </p>
                {% if task.status == 2 %}
                    <p>
                        <form action="{{url_for('task_set_status', id=task.id, status=3)}}" method="post">
                            <button type="submit" class="btn btn-success">Accept</button>
                        </form>
                    </p>
                    <p>
                        <form action="{{url_for('task_set_status', id=task.id, status=4)}}" method="post">
                            <button type="submit" class="btn btn-danger">Reject</button>
                        </form>
                    </p>
                {% endif %}
            {% endif %}
        </div>
        <div class="clear"></div>


        {% if edit and task.requester_id == g.user.id %}
            <form action="{{url_for('update_task', id=task.id)}}" method="post">
                {{form.hidden_tag()}}
                {{form_group_field(form.title, size=20, maxlength=256)}}
                {{form_group_field(form.description, cols=48, rows=12)}}
                <p>
                    <button type="submit" class="btn btn-primary">Update Task</button>
                </p>
            </form>
        {% else %}
        <div class="well">
{% filter markdown %}
{{task.description}}
{% endfilter %}
        </div>
        {% endif %}


        {% if edit and task.doer_id == g.user.id%}
            <div class="well">
                <form action="{{url_for('update_task_log', id=task.id)}}" method="post">
                    {{form.hidden_tag()}}
                    {{form_group_field(form.log, cols=48, rows=12)}}
                    <p>
                        <button type="submit" class="btn btn-primary">Update Log</button>
                    </p>
                </form>
            </div>
        {% elif task.log %}
        <div class="well">
{% filter markdown %}
{{task.log}}
{% endfilter %}
        </div>
        {% endif %}

        {% if not edit %}
        <p>
            {% if task.doer_id == g.user.id %}
                <a href="{{url_for('update_task_log', id=task.id)}}" class="btn btn-primary btn-lg">Edit Log</a>
            {% elif task.requester_id == g.user.id %}
                <a href="{{url_for('update_task', id=task.id)}}" class="btn btn-primary btn-lg">Edit Task</a>
            {% endif %}
        </p>
        {% endif %}

    </div>
{% endblock %}
